ВЫБРАТЬ
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК ДатаПолученияДохода,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода КАК СуммаДохода,
	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) КАК СуммаНалога
ПОМЕСТИТЬ Фильтр
ИЗ
	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
ГДЕ
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ ДАТАВРЕМЯ(2017, 1, 1) И ДАТАВРЕМЯ(2017, 12, 31, 23, 59, 59)
	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода <> 0
	И НЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование = НЕОПРЕДЕЛЕНО
	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.расход)

СГРУППИРОВАТЬ ПО
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение

ИМЕЮЩИЕ
	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма) > 1
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ  
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо КАК ФизическоеЛицо,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение КАК Подразделение,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Регистратор КАК Регистратор,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование КАК ДокументОснование,
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода КАК СуммаВыплаченногоДохода,
  РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода КАК МесяцНалоговогоПериода
ИЗ
	Фильтр КАК Фильтр
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		ПО Фильтр.Подразделение = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Подразделение
			И Фильтр.ФизическоеЛицо = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ФизическоеЛицо
			И Фильтр.ДокументОснование = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ДокументОснование
			И Фильтр.ДатаПолученияДохода = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.МесяцНалоговогоПериода
			И Фильтр.СуммаДохода = РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаВыплаченногоДохода
ГДЕ
	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма = 0
	
	
	Запрос=Новый Запрос;
  Запрос.Текст=тТекстЗапроса;
  //Запрос.УстановитьПараметр(",");
  Выборка=Запрос.Выполнить().Выбрать();
  Пока Выборка.Следующий() Цикл
     наборЗаписей=РегистрыНакопления.РасчетыналогоплательщиковСБюджетомПоНДФЛ.СоздатьНаборЗаписей();
наборЗаписей.отбор.регистратор.Установить(выборка.регистратор);
наборЗаписей.Прочитать();
Для Каждого Запись из наборЗаписей Цикл
Если Запись.ФизическоеЛицо=выборка.ФизическоеЛицо И
Запись.Подразделение=Выборка.Подразделение И
запись.ДокументОснование=Выборка.ДокументОснование И
Запись.МесяцНалоговогоПериода=Выборка.МесяцНалоговогоПериода И
запись.СуммаВыплаченногоДохода=Выборка.СуммаВыплаченногоДохода Тогда
наборЗаписей.Удалить(Запись);
КонецЕсли;
КонецЦикла;
наборЗаписей.Записать();
  КонецЦикла;
наборЗаписей.Записать();
  КонецЦикла;